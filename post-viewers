/**
 * RASSTUBE ULTIMATE - Visionnage de Publications
 */

// √âtendre l'objet App avec les m√©thodes de visionnage de publications
Object.assign(App, {
    // √âtat pour le visionnage de publication
    postViewer: {
        currentPost: null,
        isOpen: false,
        comments: [],
        currentCommentPage: 1
    },

    // M√âTHODES DE VISIONNAGE DE PUBLICATION
    viewPost(postId) {
        const post = this.state.posts.find(p => p.id === postId);
        if (!post) {
            this.notify("Publication non trouv√©e", "error");
            return;
        }

        this.postViewer.currentPost = post;
        this.postViewer.isOpen = true;
        
        // Charger les commentaires
        this.loadComments(postId);
        
        // Afficher la modale
        this.showPostViewer();
        
        // Ajouter une vue √† la publication
        setTimeout(() => {
            post.views = (post.views || 0) + 1;
            this.sync();
            this.updatePostViewerStats();
        }, 3000);
    },

    showPostViewer() {
        // Cr√©er la modale si elle n'existe pas
        let viewer = document.getElementById('post-viewer-modal');
        if (!viewer) {
            viewer = document.createElement('div');
            viewer.id = 'post-viewer-modal';
            viewer.className = 'post-viewer-modal hidden';
            viewer.innerHTML = `
                <div class="post-viewer-container">
                    <div class="post-viewer-close" onclick="App.closePostViewer()">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="post-viewer-content" id="post-viewer-content"></div>
                </div>
            `;
            document.body.appendChild(viewer);
            
            // Ajouter le CSS pour la modale
            this.addPostViewerStyles();
        }
        
        // Remplir le contenu
        this.renderPostViewerContent();
        
        // Afficher la modale
        viewer.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Emp√™cher le scroll du body
    },

    renderPostViewerContent() {
        const post = this.postViewer.currentPost;
        if (!post) return;
        
        const container = document.getElementById('post-viewer-content');
        if (!container) return;
        
        const isLiked = post.likedBy.includes(this.state.session.pseudo);
        const isVideo = post.type === 'video' || post.type === 'rshort' || post.type === 'youtube';
        
        container.innerHTML = `
            <div class="post-viewer-main">
                ${isVideo ? this.renderVideoPlayer(post) : this.renderImageContent(post)}
                
                <div class="post-viewer-sidebar">
                    <div class="post-author-info">
                        <img src="${post.authorPfp}" class="post-author-pfp">
                        <div>
                            <h4 class="post-author-name">${post.author}</h4>
                            <p class="post-timestamp">${this.formatTime(post.timestamp)}</p>
                        </div>
                        ${post.author === this.state.session.pseudo ? 
                            '<button class="post-edit-btn" onclick="App.editPost(' + post.id + ')"><i class="fas fa-edit"></i></button>' : 
                            '<button class="post-follow-btn" onclick="App.followUser(\'' + post.author + '\')">Suivre</button>'
                        }
                    </div>
                    
                    <div class="post-description">
                        <p>${post.title}</p>
                        <div class="post-tags">
                            ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join(' ')}
                        </div>
                    </div>
                    
                    <div class="post-stats">
                        <div class="post-stat">
                            <i class="fas fa-eye"></i>
                            <span>${this.formatNumber(post.views)} vues</span>
                        </div>
                        ${post.estimatedSubs ? `
                            <div class="post-stat success">
                                <i class="fas fa-users"></i>
                                <span>+${post.estimatedSubs} abonn√©s</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="post-actions">
                        <button class="post-action-btn ${isLiked ? 'active' : ''}" onclick="App.likePostInViewer(${post.id})">
                            <i class="fas fa-heart"></i>
                            <span>${this.formatNumber(post.likes)}</span>
                        </button>
                        <button class="post-action-btn" onclick="App.focusCommentInput()">
                            <i class="fas fa-comment"></i>
                            <span>${this.formatNumber(post.comments)}</span>
                        </button>
                        <button class="post-action-btn" onclick="App.sharePostInViewer(${post.id})">
                            <i class="fas fa-share"></i>
                            <span>${this.formatNumber(post.shares)}</span>
                        </button>
                        <button class="post-action-btn" onclick="App.savePost(${post.id})">
                            <i class="fas fa-bookmark"></i>
                            <span>Enregistrer</span>
                        </button>
                        ${post.type === 'youtube' ? `
                            <a href="${post.content.replace('embed/', 'watch?v=')}" target="_blank" class="post-action-btn youtube-btn">
                                <i class="fab fa-youtube"></i>
                                <span>YouTube</span>
                            </a>
                        ` : ''}
                    </div>
                    
                    <div class="post-comments-section">
                        <h4>Commentaires (${this.formatNumber(post.comments)})</h4>
                        
                        <div class="comment-input-container">
                            <img src="${this.state.session.pfp}" class="comment-user-pfp">
                            <div class="comment-input-wrapper">
                                <input type="text" id="comment-input" class="comment-input" placeholder="Ajouter un commentaire..." 
                                       onkeypress="if(event.key === 'Enter') App.postComment(${post.id})">
                                <button class="comment-send-btn" onclick="App.postComment(${post.id})">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="comments-list" id="comments-list">
                            ${this.renderComments()}
                        </div>
                        
                        ${this.postViewer.comments.length < post.comments ? `
                            <button class="load-more-comments" onclick="App.loadMoreComments(${post.id})">
                                <i class="fas fa-sync-alt"></i>
                                Voir plus de commentaires
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
            
            <div class="post-viewer-recommendations">
                <h4>Publications similaires</h4>
                <div class="recommendations-grid" id="post-recommendations"></div>
            </div>
        `;
        
        // Charger les recommandations
        setTimeout(() => {
            this.loadPostRecommendations(post.id);
        }, 100);
    },

    renderVideoPlayer(post) {
        if (post.type === 'youtube') {
            return `
                <div class="video-player-container">
                    <iframe 
                        src="${post.content}?autoplay=1&modestbranding=1&rel=0"
                        class="post-video-player"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            `;
        } else {
            return `
                <div class="video-player-container">
                    <video class="post-video-player" controls autoplay>
                        <source src="${post.content}" type="video/mp4">
                        Votre navigateur ne supporte pas la lecture de vid√©os.
                    </video>
                    <div class="video-controls-overlay">
                        <button class="video-control-btn" onclick="App.toggleVideoPlayback()">
                            <i class="fas fa-play" id="video-play-icon"></i>
                        </button>
                        <div class="video-progress-container">
                            <div class="video-progress-bar">
                                <div class="video-progress-fill" id="video-progress-fill"></div>
                            </div>
                        </div>
                        <button class="video-control-btn" onclick="App.toggleVideoMute()">
                            <i class="fas fa-volume-up" id="video-volume-icon"></i>
                        </button>
                    </div>
                </div>
            `;
        }
    },

    renderImageContent(post) {
        return `
            <div class="image-viewer-container">
                <img src="${post.content}" class="post-image-viewer" alt="${post.title}">
                <div class="image-zoom-controls">
                    <button class="zoom-btn" onclick="App.zoomImage(1.2)">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button class="zoom-btn" onclick="App.zoomImage(0.8)">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button class="zoom-btn" onclick="App.resetImageZoom()">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </button>
                </div>
            </div>
        `;
    },

    renderComments() {
        if (this.postViewer.comments.length === 0) {
            return `
                <div class="no-comments">
                    <i class="fas fa-comment-slash"></i>
                    <p>Soyez le premier √† commenter !</p>
                </div>
            `;
        }
        
        return this.postViewer.comments.map(comment => `
            <div class="comment-item">
                <img src="${comment.userPfp}" class="comment-pfp">
                <div class="comment-content">
                    <div class="comment-header">
                        <strong>${comment.userName}</strong>
                        <span class="comment-time">${this.formatTime(comment.timestamp)}</span>
                    </div>
                    <p class="comment-text">${comment.text}</p>
                    <div class="comment-actions">
                        <button class="comment-action-btn" onclick="App.likeComment(${comment.id})">
                            <i class="fas fa-heart"></i>
                            <span>${this.formatNumber(comment.likes)}</span>
                        </button>
                        <button class="comment-action-btn" onclick="App.replyToComment(${comment.id})">
                            <i class="fas fa-reply"></i>
                            <span>R√©pondre</span>
                        </button>
                        ${comment.userName === this.state.session.pseudo ? `
                            <button class="comment-action-btn danger" onclick="App.deleteComment(${comment.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    },

    loadComments(postId) {
        // Simuler le chargement de commentaires
        setTimeout(() => {
            // Commentaires de d√©monstration
            this.postViewer.comments = [
                {
                    id: 1,
                    postId: postId,
                    userName: 'Sarah',
                    userPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                    text: 'Super contenu ! J\'adore cette vid√©o üòç',
                    likes: 24,
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    replies: []
                },
                {
                    id: 2,
                    postId: postId,
                    userName: 'Alex',
                    userPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
                    text: 'Quelle qualit√© d\'image ! Quel mat√©riel utilises-tu ?',
                    likes: 18,
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    replies: []
                },
                {
                    id: 3,
                    postId: postId,
                    userName: 'Rayan',
                    userPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                    text: 'Merci pour le tuto, tr√®s utile pour les d√©butants !',
                    likes: 32,
                    timestamp: new Date(Date.now() - 10800000).toISOString(),
                    replies: []
                }
            ];
            
            if (this.postViewer.isOpen) {
                document.getElementById('comments-list').innerHTML = this.renderComments();
            }
        }, 500);
    },

    loadMoreComments(postId) {
        // Simuler le chargement de plus de commentaires
        setTimeout(() => {
            const newComments = [
                {
                    id: Date.now() + 1,
                    postId: postId,
                    userName: 'Marie',
                    userPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Marie',
                    text: 'Je partage √† mes amis, c\'est g√©nial !',
                    likes: 8,
                    timestamp: new Date(Date.now() - 14400000).toISOString(),
                    replies: []
                },
                {
                    id: Date.now() + 2,
                    postId: postId,
                    userName: 'Tom',
                    userPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Tom',
                    text: 'Encore une belle r√©alisation, bravo !',
                    likes: 12,
                    timestamp: new Date(Date.now() - 18000000).toISOString(),
                    replies: []
                }
            ];
            
            this.postViewer.comments.push(...newComments);
            document.getElementById('comments-list').innerHTML = this.renderComments();
        }, 800);
    },

    loadPostRecommendations(currentPostId) {
        const currentPost = this.postViewer.currentPost;
        if (!currentPost) return;
        
        // Trouver des publications similaires
        const recommendations = this.state.posts
            .filter(p => p.id !== currentPostId && 
                   (p.type === currentPost.type || 
                    p.tags.some(tag => currentPost.tags.includes(tag))))
            .slice(0, 4);
        
        const container = document.getElementById('post-recommendations');
        if (!container) return;
        
        if (recommendations.length === 0) {
            container.innerHTML = `
                <div class="no-recommendations">
                    <i class="fas fa-compass"></i>
                    <p>Aucune recommandation pour le moment</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = recommendations.map(post => `
            <div class="recommendation-card" onclick="App.viewPost(${post.id})">
                ${post.type === 'video' || post.type === 'rshort' || post.type === 'youtube' ? 
                    `<div class="recommendation-thumbnail">
                        <img src="${post.content}" alt="${post.title}">
                        <div class="video-indicator">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>` : 
                    `<img src="${post.content}" class="recommendation-thumbnail" alt="${post.title}">`
                }
                <div class="recommendation-info">
                    <h5>${post.title.length > 50 ? post.title.substring(0, 50) + '...' : post.title}</h5>
                    <div class="recommendation-stats">
                        <span><i class="fas fa-eye"></i> ${this.formatNumber(post.views)}</span>
                        <span><i class="fas fa-heart"></i> ${this.formatNumber(post.likes)}</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    // ACTIONS DE VISIONNAGE
    closePostViewer() {
        const viewer = document.getElementById('post-viewer-modal');
        if (viewer) {
            viewer.classList.add('hidden');
        }
        document.body.style.overflow = 'auto';
        this.postViewer.isOpen = false;
        this.postViewer.currentPost = null;
        this.postViewer.comments = [];
        this.postViewer.currentCommentPage = 1;
    },

    likePostInViewer(postId) {
        const post = this.state.posts.find(p => p.id === postId);
        if (!post) return;
        
        const index = post.likedBy.indexOf(this.state.session.pseudo);
        
        if (index === -1) {
            post.likes++;
            post.likedBy.push(this.state.session.pseudo);
            this.notify("‚ù§Ô∏è Publication aim√©e ! +5 XP", "success");
            this.addXP(5);
            
            // Animation de c≈ìur
            const heart = document.createElement('div');
            heart.innerHTML = '<i class="fas fa-heart" style="color:var(--accent); font-size:50px;"></i>';
            heart.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 99999;
                animation: heartbeat 0.5s ease;
                pointer-events: none;
            `;
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 500);
        } else {
            post.likes--;
            post.likedBy.splice(index, 1);
            this.notify("Like retir√©", "info");
        }
        
        this.sync();
        this.updatePostViewerStats();
    },

    sharePostInViewer(postId) {
        const post = this.state.posts.find(p => p.id === postId);
        if (!post) return;
        
        post.shares = (post.shares || 0) + 1;
        this.sync();
        this.addXP(10);
        
        this.notify("üì§ Partage r√©ussi ! +10 XP", "success");
        
        // Options de partage
        if (navigator.share) {
            navigator.share({
                title: `${post.author} sur Rasstube`,
                text: post.title,
                url: window.location.href + '?post=' + post.id
            });
        } else {
            navigator.clipboard.writeText(`Regarde cette publication sur Rasstube !\n\n${post.author}: ${post.title}\n\n${window.location.href}?post=${post.id}`);
            this.notify("üìã Lien copi√© dans le presse-papier !", "success");
        }
        
        this.updatePostViewerStats();
    },

    postComment(postId) {
        const input = document.getElementById('comment-input');
        const commentText = input.value.trim();
        
        if (!commentText) {
            this.notify("Veuillez √©crire un commentaire", "error");
            return;
        }
        
        // Ajouter le commentaire
        const newComment = {
            id: Date.now(),
            postId: postId,
            userName: this.state.session.pseudo,
            userPfp: this.state.session.pfp,
            text: commentText,
            likes: 0,
            timestamp: new Date().toISOString(),
            replies: []
        };
        
        this.postViewer.comments.unshift(newComment);
        
        // Mettre √† jour le compteur de commentaires
        const post = this.state.posts.find(p => p.id === postId);
        if (post) {
            post.comments = (post.comments || 0) + 1;
            this.sync();
        }
        
        // Mettre √† jour l'interface
        document.getElementById('comments-list').innerHTML = this.renderComments();
        this.updatePostViewerStats();
        
        // R√©initialiser l'input
        input.value = '';
        
        // Ajouter XP pour commentaire
        this.addXP(3);
        
        this.notify("üí¨ Commentaire publi√© ! +3 XP", "success");
    },

    likeComment(commentId) {
        const comment = this.postViewer.comments.find(c => c.id === commentId);
        if (!comment) return;
        
        comment.likes++;
        document.getElementById('comments-list').innerHTML = this.renderComments();
        this.addXP(2);
    },

    replyToComment(commentId) {
        const input = document.getElementById('comment-input');
        const comment = this.postViewer.comments.find(c => c.id === commentId);
        
        if (comment) {
            input.value = `@${comment.userName} `;
            input.focus();
            this.notify(`R√©ponse √† ${comment.userName}`, "info");
        }
    },

    deleteComment(commentId) {
        const index = this.postViewer.comments.findIndex(c => c.id === commentId);
        if (index !== -1 && confirm("Supprimer ce commentaire ?")) {
            this.postViewer.comments.splice(index, 1);
            document.getElementById('comments-list').innerHTML = this.renderComments();
            
            // Mettre √† jour le compteur de commentaires
            const post = this.state.posts.find(p => p.id === this.postViewer.currentPost.id);
            if (post) {
                post.comments = Math.max(0, (post.comments || 0) - 1);
                this.sync();
                this.updatePostViewerStats();
            }
            
            this.notify("üóëÔ∏è Commentaire supprim√©", "success");
        }
    },

    savePost(postId) {
        const post = this.state.posts.find(p => p.id === postId);
        if (!post) return;
        
        // V√©rifier si d√©j√† sauvegard√©
        const alreadySaved = this.state.savedPosts.find(p => p.id === postId);
        
        if (!alreadySaved) {
            this.state.savedPosts.push({
                ...post,
                savedAt: new Date().toISOString()
            });
            this.notify("üìå Publication enregistr√©e !", "success");
            this.addXP(5);
        } else {
            const index = this.state.savedPosts.findIndex(p => p.id === postId);
            this.state.savedPosts.splice(index, 1);
            this.notify("Publication retir√©e des enregistrements", "info");
        }
        
        localStorage.setItem('rt_v5_saved', JSON.stringify(this.state.savedPosts));
    },

    followUser(username) {
        const user = this.state.users.find(u => u.pseudo === username);
        if (!user || username === this.state.session.pseudo) return;
        
        // Simuler le suivi
        user.followers = (user.followers || 0) + 1;
        this.state.session.following = (this.state.session.following || 0) + 1;
        
        this.sync();
        this.notify(`‚úÖ Vous suivez maintenant ${username} !`, "success");
        this.addXP(10);
        
        // Mettre √† jour le bouton
        const followBtn = document.querySelector('.post-follow-btn');
        if (followBtn) {
            followBtn.innerHTML = '<i class="fas fa-check"></i> Suivi';
            followBtn.classList.add('following');
            followBtn.onclick = () => this.unfollowUser(username);
        }
    },

    unfollowUser(username) {
        const user = this.state.users.find(u => u.pseudo === username);
        if (!user) return;
        
        user.followers = Math.max(0, (user.followers || 0) - 1);
        this.state.session.following = Math.max(0, (this.state.session.following || 0) - 1);
        
        this.sync();
        this.notify(`Vous ne suivez plus ${username}`, "info");
        
        // Mettre √† jour le bouton
        const followBtn = document.querySelector('.post-follow-btn');
        if (followBtn) {
            followBtn.innerHTML = 'Suivre';
            followBtn.classList.remove('following');
            followBtn.onclick = () => this.followUser(username);
        }
    },

    editPost(postId) {
        this.notify("√âdition de publication - Fonctionnalit√© en d√©veloppement", "info");
    },

    // CONTROLES VID√âO/IMAGE
    toggleVideoPlayback() {
        const video = document.querySelector('.post-video-player');
        const icon = document.getElementById('video-play-icon');
        
        if (video && video.paused) {
            video.play();
            icon.className = 'fas fa-pause';
        } else if (video) {
            video.pause();
            icon.className = 'fas fa-play';
        }
    },

    toggleVideoMute() {
        const video = document.querySelector('.post-video-player');
        const icon = document.getElementById('video-volume-icon');
        
        if (video) {
            video.muted = !video.muted;
            icon.className = video.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
        }
    },

    zoomImage(factor) {
        const image = document.querySelector('.post-image-viewer');
        if (image) {
            const currentScale = parseFloat(image.style.transform.replace('scale(', '').replace(')', '')) || 1;
            image.style.transform = `scale(${currentScale * factor})`;
        }
    },

    resetImageZoom() {
        const image = document.querySelector('.post-image-viewer');
        if (image) {
            image.style.transform = 'scale(1)';
        }
    },

    focusCommentInput() {
        const input = document.getElementById('comment-input');
        if (input) {
            input.focus();
            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    },

    updatePostViewerStats() {
        const post = this.postViewer.currentPost;
        if (!post || !this.postViewer.isOpen) return;
        
        // Mettre √† jour les statistiques dans la vue
        const likeBtn = document.querySelector('.post-action-btn');
        const likeCount = document.querySelector('.post-action-btn span');
        const commentCount = document.querySelectorAll('.post-action-btn')[1]?.querySelector('span');
        const shareCount = document.querySelectorAll('.post-action-btn')[2]?.querySelector('span');
        const viewCount = document.querySelector('.post-stat span');
        const commentHeader = document.querySelector('.post-comments-section h4');
        
        if (likeBtn) {
            likeBtn.classList.toggle('active', post.likedBy.includes(this.state.session.pseudo));
        }
        if (likeCount) likeCount.textContent = this.formatNumber(post.likes);
        if (commentCount) commentCount.textContent = this.formatNumber(post.comments);
        if (shareCount) shareCount.textContent = this.formatNumber(post.shares);
        if (viewCount) viewCount.textContent = this.formatNumber(post.views) + ' vues';
        if (commentHeader) commentHeader.textContent = `Commentaires (${this.formatNumber(post.comments)})`;
    },

    addPostViewerStyles() {
        const style = document.createElement('style');
        style.textContent = `
            /* POST VIEWER MODAL */
            .post-viewer-modal {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.95);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            }
            
            .post-viewer-container {
                background: var(--bg-card);
                border-radius: var(--radius-lg);
                width: 95%;
                max-width: 1200px;
                height: 90vh;
                display: flex;
                flex-direction: column;
                position: relative;
                overflow: hidden;
            }
            
            .post-viewer-close {
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(0, 0, 0, 0.7);
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 100;
                transition: var(--transition);
            }
            
            .post-viewer-close:hover {
                background: var(--accent);
                transform: rotate(90deg);
            }
            
            .post-viewer-close i {
                color: white;
                font-size: 20px;
            }
            
            .post-viewer-content {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
            }
            
            .post-viewer-main {
                display: grid;
                grid-template-columns: 1fr 400px;
                gap: 30px;
                margin-bottom: 30px;
            }
            
            /* VIDEO PLAYER */
            .video-player-container {
                position: relative;
                background: black;
                border-radius: var(--radius-md);
                overflow: hidden;
                aspect-ratio: 16/9;
            }
            
            .post-video-player {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            
            .video-controls-overlay {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(transparent, rgba(0,0,0,0.7));
                padding: 15px;
                display: flex;
                align-items: center;
                gap: 15px;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .video-player-container:hover .video-controls-overlay {
                opacity: 1;
            }
            
            .video-control-btn {
                background: rgba(255,255,255,0.2);
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition);
            }
            
            .video-control-btn:hover {
                background: var(--accent);
                transform: scale(1.1);
            }
            
            .video-progress-container {
                flex: 1;
            }
            
            .video-progress-bar {
                height: 4px;
                background: rgba(255,255,255,0.3);
                border-radius: 2px;
                overflow: hidden;
            }
            
            .video-progress-fill {
                height: 100%;
                background: var(--accent);
                width: 30%;
            }
            
            /* IMAGE VIEWER */
            .image-viewer-container {
                position: relative;
                background: black;
                border-radius: var(--radius-md);
                overflow: hidden;
                max-height: 70vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .post-image-viewer {
                max-width: 100%;
                max-height: 70vh;
                object-fit: contain;
                transition: transform 0.3s ease;
            }
            
            .image-zoom-controls {
                position: absolute;
                bottom: 20px;
                right: 20px;
                display: flex;
                gap: 10px;
                background: rgba(0,0,0,0.5);
                padding: 10px;
                border-radius: var(--radius-md);
            }
            
            .zoom-btn {
                background: rgba(255,255,255,0.2);
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition);
            }
            
            .zoom-btn:hover {
                background: var(--accent);
            }
            
            /* SIDEBAR */
            .post-author-info {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid var(--border);
            }
            
            .post-author-pfp {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                border: 2px solid var(--accent);
            }
            
            .post-author-name {
                margin: 0;
                font-size: 18px;
            }
            
            .post-timestamp {
                margin: 5px 0 0;
                color: var(--text-dim);
                font-size: 13px;
            }
            
            .post-edit-btn, .post-follow-btn {
                margin-left: auto;
                background: var(--accent-soft);
                color: var(--accent);
                border: 1px solid var(--accent);
                padding: 8px 15px;
                border-radius: var(--radius-md);
                font-weight: 600;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .post-follow-btn.following {
                background: var(--success);
                color: white;
                border-color: var(--success);
            }
            
            .post-edit-btn:hover, .post-follow-btn:hover {
                background: var(--accent);
                color: white;
                transform: translateY(-2px);
            }
            
            .post-description {
                margin-bottom: 20px;
            }
            
            .post-description p {
                margin: 0 0 15px 0;
                line-height: 1.5;
            }
            
            .post-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .post-tag {
                background: var(--accent-soft);
                color: var(--accent);
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }
            
            .post-stats {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid var(--border);
            }
            
            .post-stat {
                display: flex;
                align-items: center;
                gap: 8px;
                color: var(--text-dim);
                font-size: 14px;
            }
            
            .post-stat.success {
                color: var(--success);
            }
            
            .post-stat i {
                font-size: 16px;
            }
            
            .post-actions {
                display: flex;
                gap: 10px;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }
            
            .post-action-btn {
                flex: 1;
                min-width: 80px;
                background: var(--bg-input);
                border: 1px solid var(--border);
                color: var(--text-dim);
                padding: 12px;
                border-radius: var(--radius-md);
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 5px;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .post-action-btn.active {
                background: rgba(255, 0, 50, 0.1);
                border-color: var(--accent);
                color: var(--accent);
            }
            
            .post-action-btn:hover {
                background: var(--bg-elevated);
                transform: translateY(-3px);
            }
            
            .post-action-btn.youtube-btn {
                background: rgba(255, 0, 0, 0.1);
                border-color: var(--youtube-red);
                color: var(--youtube-red);
            }
            
            .post-action-btn i {
                font-size: 20px;
            }
            
            .post-action-btn span {
                font-size: 12px;
                font-weight: 600;
            }
            
            /* COMMENTS SECTION */
            .post-comments-section {
                margin-top: 20px;
            }
            
            .post-comments-section h4 {
                margin: 0 0 15px 0;
            }
            
            .comment-input-container {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .comment-user-pfp {
                width: 40px;
                height: 40px;
                border-radius: 50%;
            }
            
            .comment-input-wrapper {
                flex: 1;
                position: relative;
            }
            
            .comment-input {
                width: 100%;
                background: var(--bg-input);
                border: 1px solid var(--border);
                border-radius: 20px;
                padding: 12px 50px 12px 15px;
                color: white;
                outline: none;
                transition: var(--transition);
            }
            
            .comment-input:focus {
                border-color: var(--accent);
            }
            
            .comment-send-btn {
                position: absolute;
                right: 5px;
                top: 5px;
                background: var(--accent);
                border: none;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition);
            }
            
            .comment-send-btn:hover {
                transform: scale(1.1);
            }
            
            .comments-list {
                max-height: 300px;
                overflow-y: auto;
                margin-bottom: 15px;
            }
            
            .comment-item {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid rgba(255,255,255,0.05);
            }
            
            .comment-pfp {
                width: 35px;
                height: 35px;
                border-radius: 50%;
            }
            
            .comment-content {
                flex: 1;
            }
            
            .comment-header {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
            }
            
            .comment-header strong {
                font-size: 14px;
            }
            
            .comment-time {
                color: var(--text-dim);
                font-size: 12px;
            }
            
            .comment-text {
                margin: 0 0 10px 0;
                font-size: 14px;
                line-height: 1.4;
            }
            
            .comment-actions {
                display: flex;
                gap: 15px;
            }
            
            .comment-action-btn {
                background: none;
                border: none;
                color: var(--text-dim);
                font-size: 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 5px;
                transition: var(--transition);
            }
            
            .comment-action-btn:hover {
                color: var(--accent);
            }
            
            .comment-action-btn.danger:hover {
                color: #ff4444;
            }
            
            .no-comments {
                text-align: center;
                padding: 30px;
                color: var(--text-dim);
            }
            
            .no-comments i {
                font-size: 40px;
                margin-bottom: 10px;
            }
            
            .load-more-comments {
                width: 100%;
                background: var(--bg-input);
                border: 1px solid var(--border);
                color: var(--text-dim);
                padding: 10px;
                border-radius: var(--radius-md);
                cursor: pointer;
                transition: var(--transition);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            
            .load-more-comments:hover {
                background: var(--bg-elevated);
                color: var(--accent);
            }
            
            /* RECOMMENDATIONS */
            .post-viewer-recommendations {
                border-top: 1px solid var(--border);
                padding-top: 20px;
            }
            
            .post-viewer-recommendations h4 {
                margin: 0 0 15px 0;
            }
            
            .recommendations-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            
            .recommendation-card {
                background: var(--bg-input);
                border-radius: var(--radius-md);
                overflow: hidden;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .recommendation-card:hover {
                transform: translateY(-5px);
                background: var(--bg-elevated);
            }
            
            .recommendation-thumbnail {
                width: 100%;
                aspect-ratio: 16/9;
                object-fit: cover;
                position: relative;
            }
            
            .video-indicator {
                position: absolute;
                bottom: 5px;
                right: 5px;
                background: rgba(0,0,0,0.7);
                color: white;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
            }
            
            .recommendation-info {
                padding: 10px;
            }
            
            .recommendation-info h5 {
                margin: 0 0 5px 0;
                font-size: 12px;
                line-height: 1.3;
            }
            
            .recommendation-stats {
                display: flex;
                gap: 10px;
                font-size: 10px;
                color: var(--text-dim);
            }
            
            .no-recommendations {
                grid-column: 1 / -1;
                text-align: center;
                padding: 20px;
                color: var(--text-dim);
            }
            
            /* RESPONSIVE */
            @media (max-width: 1024px) {
                .post-viewer-main {
                    grid-template-columns: 1fr;
                }
                
                .recommendations-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }
            
            @media (max-width: 768px) {
                .post-viewer-container {
                    width: 100%;
                    height: 100vh;
                    border-radius: 0;
                }
                
                .post-actions {
                    flex-wrap: wrap;
                }
                
                .post-action-btn {
                    min-width: 70px;
                }
            }
        `;
        document.head.appendChild(style);
    }
});